<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Jtopo测试页面</title>
    <link rel="stylesheet" type="text/css" href="/static/bootstrap/css/bootstrap.min.css">

     <!-- 右测栏目 Jtopo --->
    <!--
    <link rel="stylesheet" type="text/css" href="/static/jtopot/css/base.css">
	-->

	<script src="/static/plugins/jQuery/jQuery-2.1.4.min.js"></script>
    <script type="text/javascript" src="/static/jtopot/js/jtopo-min.js"></script>
	<script type="text/javascript" src="/static/jtopot/js/toolbar.js"></script>

    <!-- 左侧表单栏目 --->
    <link rel="stylesheet" type="text/css" href="/static/jtopot/form/css/style.css">
    <script src="/static/jtopot/form/js/jquery.mousewheel.min.js"></script>
    <script src="/static/jtopot/form/js/increment.js"></script>
</head>
<body>

<div class="container">
    <h1 style="text-align: center"> Jtopo 测试模板, 调整边距等</h1>
 <div class="row">
        <p>
            左边的Form
        </p>


        <div class="col-md-4" style="background-color: #dedef8; box-shadow: inset 1px -1px 1px #444, inset -1px 1px 1px #444;">

            <div id="page-wrap">
                <h1> Jtopo 表单输入  </h1>
                <p>-----------------------------------------</p>

                <h2>Jtopo画布设置</h2>
                <div>
                    <label > 画布的长度 </label>
                    <input type="text" class="wheelable" value="950" name="max_width" size="3" />
                </div>

                <div>
                    <label > 画布的高度 </label>
                    <input type="text"  class="wheelable" value="750" name="max_height" size="3" />
                </div>

                <div>
                    <label > 画布的上空高度 </label>
                    <input type="text"  class="wheelable" value="40" name="top_blank" size="3" />
                </div>

                <div>
                    <label > 画布的下空高度 </label>
                    <input type="text"  class="wheelable" value="110" name="buttom_blank" size="3" />
                </div>


                <div>
                    <label > 画布的左空宽度 </label>
                    <input type="text"  class="wheelable" value="130" name="left_blank" size="3" />
                </div>

                <div>
                    <label > 画布的右空宽度 </label>
                    <input type="text"  class="wheelable" value="150" name="right_blank" size="3" />
                </div>


                    <button  type="button" class="btn btn-primary" onclick="commit()" id="commit">提交</button>
                    <script>
                        function canvas_config(){

                            var max_width = $('input[name=max_width]').attr('value')
                            var max_height = $('input[name=max_height]').attr('value')
                            var left_blank = $('input[name=left_blank]').attr('value')
                            var top_blank = $('input[name=top_blank]').attr('value')
                            var right_blank = $('input[name=right_blank]').attr('value')
                            var buttom_blank = $('input[name=buttom_blank]').attr('value')

                            return {
                                "max_width": max_width,
                                "max_height": max_height,
                                "left_blank": left_blank,
                                "top_blank": top_blank,
                                "right_blank": right_blank,
                                "buttom_blank": buttom_blank
                            }
                        }
                    </script>


                <script type="text/javascript">

                        $("input[name=max_width]").bind('input porpertychange',function(){
                        var max_width = $('input[name=max_width]').attr('value')

                        console.log(max_width);
                        });

                </script>
            </div>
        </div>
     <style>
         #main_div{
            background-color: #dedef8;
             box-shadow: inset 1px -1px 1px #444, inset -1px 1px 1px #444;
         }
     </style>
        <div class="col-md-8" style="">
            <div id="content">
					<canvas width="850" height="550" id="canvas"></canvas>
            </div>
        </div>

    </div>

    <script id='code'>

        function root(forms) {

            var canvas = document.getElementById('canvas');
            // 导入数据
            canvas.width = Number(forms["max_width"])
            canvas.height = Number(forms["max_height"])
            var max_width = canvas.width
            var max_height = canvas.height

            // 给出间隔其他留空(画布的宽度, 高度, 左空， 上空,  右空, 下空, squrt(data.length), )
            function getPositionsConfig(canvas_width, canvas_height, left_blank, top_blank, right_blank, buttom_blank, fang){
                var left_space = (canvas_width - left_blank - right_blank)/(fang-1)
                var top_space = (canvas_height - top_blank - buttom_blank)/(fang-1)
                return {
                    "fang": fang,
                    "left_space": left_space,
                    "top_space": top_space,
                    "left_blank": left_blank,
                    "top_blank": top_blank
                }
            }

            // 假设传进来的告警IP信息为Json形式
            // 手动写参数
            function setForgeData(fang) {
                var temp_data = []
                for (var i = 0; i < fang*fang - 3; i++) {
                    if (i % 3 == 0)
                        temp_data.push({"ip": "192.168.0." + (i + 1), "stat": 0})
                    else temp_data.push({"ip": "192.168.0." + (i + 1), "stat": 1})
                }
                return temp_data
            }

            function Main(dict, temp_data) {
                fang = dict["fang"]
                left_blank = dict["left_blank"]
                left_space = dict["left_space"]
                top_space = dict["top_space"]
                top_blank = dict["top_blank"]

                var Nodes = []
                for(var k = 0; k<temp_data.length; k++){
                    var hang = parseInt(k / fang)
                    var lie = k % fang
                    var temp_node = node(left_blank + left_space* hang, top_blank + top_space* lie, 'server.png')
                    temp_node.click(function(event){
                        // 点击后可以弹出表格或者栏目
						console.log("单击");
					});

                    temp_node.text = "192.169.0." + (k+1)
                    if( temp_data[k]["stat"] == 1 ){
                        temp_node.alarm = "||||||"
                    }
                    Nodes.push(temp_node)
                }


                setInterval(function(){
                    for(var i =0; i< Nodes.length; i++){
                        if (temp_data[i]["stat"] == 0) continue;

                        node = Nodes[i]
                        if(node.alarm == '||||||'){
                            node.alarm = null;
                        }else{
                            node.alarm = '||||||'
                        }
                    }
			    }, 600);
            }

            // ## 基于最大长宽的基础画出方振 %fang 的除
            var stage = new JTopo.Stage(canvas);
            // 显示工具栏
            // showJTopoToobar(stage);

            var scene = new JTopo.Scene();
            scene.background = '/static/jtopot/img/bg.jpg';

            function node(x, y, img) {
                var node = new JTopo.Node();
                node.setImage('/static/jtopot/img/statistics/' + img, true);
                node.setLocation(x, y);
                scene.add(node);
                return node;
            }

            Main(getPositionsConfig(
                Number(forms["max_width"]),
                Number(forms["max_height"]),
                Number(forms["left_blank"]),
                Number(forms["top_blank"]),
                Number(forms["right_blank"]),
                Number(forms["buttom_blank"]),
                5), setForgeData(5));

            stage.add(scene);
        }

        function commit(){
            var forms = canvas_config()
            root(forms)
        }

        //commit()

	</script>
</div>
</body>
</html>